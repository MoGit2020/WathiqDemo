<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wathiq.om - Making Renting Safe</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Kufi+Arabic:wght@400;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Kufi Arabic', sans-serif; background-color: #f8fafc; }
        .slide-in { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        
        /* Contract & Form Styling */
        .mm-form { background: white; border: 1px solid #cbd5e1; padding: 40px; max-width: 900px; margin: 0 auto; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .mm-input { width: 100%; border: 1px solid #e2e8f0; padding: 6px; font-size: 12px; background: #f8fafc; color: #334155; border-radius: 4px; height: 28px; }
        .mm-label { font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 2px; }
        .typing { background-color: #f0fdf4; border-color: #4ade80; transition: background 0.3s; }
        .signature-font { font-family: 'Dancing Script', cursive; font-size: 1.8rem; }

        /* Stamp */
        .stamp-enter { opacity: 0; transform: scale(3) rotate(-20deg); }
        .stamp-active { opacity: 0.9; transform: scale(1) rotate(-12deg); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* Money Flow Animation */
        .flow-line { position: relative; overflow: hidden; background: #e2e8f0; height: 2px; }
        .flow-dot { position: absolute; width: 8px; height: 8px; border-radius: 50%; background: #10b981; top: -3px; animation: flow 2s infinite linear; }
        @keyframes flow { 0% { left: 0; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { left: 100%; opacity: 0; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATA ---
        const TENANT = { 
            name: "Sara Khan", id: "CV99281", mobile: "99887766", email: "sara.khan@gmail.com", 
            avatar: "https://ui-avatars.com/api/?name=Sara+Khan&background=db2777&color=fff",
            rating: 4.8, 
            sector: "Private Sector (Oil & Gas)", nationality: "Expat (Resident)",
            reviews: [
                { user: "Landlord X", comment: "Paid rent on time every month via Direct Debit." },
                { user: "Landlord Y", comment: "Kept the apartment very clean." }
            ]
        };
        
        const LANDLORDS = {
            'Ahmed': { 
                name: "Ahmed Al-Harthi", id: "CV111", mobile: "99112233", 
                avatar: "https://ui-avatars.com/api/?name=Ahmed+Harthi&background=0f172a&color=fff", 
                rating: 4.9, verified: true,
                reviews: [
                    { user: "John D.", comment: "Very responsive to maintenance requests." },
                    { user: "Fatma S.", comment: "Fair and honest landlord." }
                ]
            },
            'Salim': { name: "Salim Al-Alawi", id: "CV222", mobile: "99223344", avatar: "https://ui-avatars.com/api/?name=Salim+Alawi&background=1e293b&color=fff", rating: 4.7, verified: true, reviews: [] },
            'Said': { name: "Said Al-Mamari", id: "CV333", mobile: "99334455", avatar: "https://ui-avatars.com/api/?name=Said+Mamari&background=334155&color=fff", rating: 4.5, verified: true, reviews: [] },
            'Khlfan': { name: "Khlfan Al-Siyabi", id: "CV444", mobile: "99445566", avatar: "https://ui-avatars.com/api/?name=Khlfan+Siyabi&background=475569&color=fff", rating: 4.2, verified: false, reviews: [] }
        };

        const PROPERTIES = [
            { id: 1, landlord: 'Ahmed', title: "Sea View 2BHK - Al Mouj", price: 600, beds: 2, baths: 3, area: 145, loc: "Marsa 1, Al Mouj", block: "Marsa 1", way: "401", bldg: "B-12", plot: "88-A", elec: "2021-99-11", water: "W-8821", img: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80", type: "Apartment", badge: "Wathiq Monthly" },
            { id: 2, landlord: 'Salim', title: "Luxury Villa - Muscat Hills", price: 950, beds: 4, baths: 5, area: 350, loc: "Golf View, Muscat Hills", block: "MH-2", way: "202", bldg: "V-55", plot: "102-B", elec: "2022-55-22", water: "W-5522", img: "https://images.unsplash.com/photo-1600596542815-2250651d2116?auto=format&fit=crop&w=800&q=80", type: "Villa", badge: "Wathiq Monthly" },
            { id: 3, landlord: 'Said', title: "Modern Studio - Azaiba", price: 300, beds: 1, baths: 1, area: 75, loc: "Azaiba North", block: "AZ-1", way: "101", bldg: "S-10", plot: "12-C", elec: "2023-11-33", water: "W-1133", img: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=80", type: "Studio", badge: "Direct Debit" },
            { id: 4, landlord: 'Khlfan', title: "Family Apt - Bausher", price: 450, beds: 3, baths: 3, area: 180, loc: "Bausher Heights", block: "BA-3", way: "303", bldg: "A-22", plot: "44-D", elec: "2024-44-44", water: "W-4444", img: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?auto=format&fit=crop&w=800&q=80", type: "Apartment", badge: "Direct Debit" },
            { id: 5, landlord: 'Ahmed', title: "Beachfront Villa - Shatti", price: 1200, beds: 5, baths: 6, area: 450, loc: "Shatti Al Qurum", block: "SQ-1", way: "505", bldg: "V-01", plot: "01-A", elec: "2020-01-01", water: "W-0101", img: "https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&w=800&q=80", type: "Villa", badge: "Premium" },
            { id: 6, landlord: 'Salim', title: "City Apt - Qurum", price: 500, beds: 2, baths: 2, area: 120, loc: "Qurum Commercial Area", block: "QC-2", way: "606", bldg: "C-09", plot: "99-E", elec: "2019-99-99", water: "W-9999", img: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80", type: "Apartment", badge: "Wathiq Monthly" },
            { id: 7, landlord: 'Said', title: "Student Flat - Al Khoud", price: 250, beds: 1, baths: 1, area: 60, loc: "Al Khoud Souq", block: "AK-4", way: "707", bldg: "F-12", plot: "12-F", elec: "2025-12-12", water: "W-1212", img: "https://images.unsplash.com/photo-1502005229766-3c8ef56462b1?auto=format&fit=crop&w=800&q=80", type: "Flat", badge: "Direct Debit" },
            { id: 8, landlord: 'Khlfan', title: "Cozy 2BHK - Seeb", price: 350, beds: 2, baths: 2, area: 110, loc: "Seeb Sea Road", block: "SE-5", way: "808", bldg: "H-88", plot: "88-G", elec: "2021-88-88", water: "W-8888", img: "https://images.unsplash.com/photo-1484154218962-a1c002085d2f?auto=format&fit=crop&w=800&q=80", type: "House", badge: "Direct Debit" },
            { id: 9, landlord: 'Ahmed', title: "Commercial Space - Ruwi", price: 700, beds: 0, baths: 1, area: 200, loc: "Ruwi CBD", block: "RU-6", way: "909", bldg: "O-99", plot: "99-H", elec: "2020-00-00", water: "W-0000", img: "https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=800&q=80", type: "Office", badge: "Commercial" }
        ];

        // --- COMPONENTS ---

        const LandingPage = ({ onNav }) => (
            <div className="min-h-screen flex flex-col bg-slate-900 relative overflow-hidden text-white">
                <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1512453979798-5ea904ac6605?auto=format&fit=crop&w=1920&q=80')] opacity-20 bg-cover bg-center"></div>
                <nav className="relative z-10 p-6 flex justify-between items-center glass border-b border-white/10">
                    <div className="text-2xl font-bold flex items-center gap-2 text-white">
                        <i className="fas fa-shield-alt text-emerald-400"></i> Wathiq.om
                    </div>
                    <div className="space-x-4">
                        <button onClick={() => onNav('landlord')} className="text-sm font-medium hover:text-emerald-400 transition">Landlords</button>
                        <button onClick={() => onNav('marketplace')} className="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2 rounded-full font-bold transition">Sign In</button>
                    </div>
                </nav>
                <main className="relative z-10 flex-1 flex flex-col justify-center items-center text-center px-4 slide-in">
                    <div className="bg-emerald-500/10 border border-emerald-500/30 text-emerald-300 px-4 py-1 rounded-full text-sm font-bold mb-6">
                        <i className="fas fa-check-circle mr-2"></i> Royal Decree 12/2025 Compliant
                    </div>
                    <h1 className="text-5xl md:text-7xl font-extrabold mb-6 leading-tight tracking-tight">
                        Rent Smart.<br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">Pay Monthly.</span>
                    </h1>
                    <p className="text-xl text-gray-300 mb-10 max-w-2xl">The only platform in Oman where <b>Verified Tenants</b> rent without cheques.</p>
                    <button onClick={() => onNav('marketplace')} className="bg-emerald-500 hover:bg-emerald-400 text-white px-8 py-4 rounded-xl font-bold text-xl shadow-lg shadow-emerald-900/50 transition transform hover:scale-105 flex items-center gap-2">
                        <i className="fas fa-search"></i> Browse Homes
                    </button>
                </main>
            </div>
        );

        const DashboardLayout = ({ children, role, onNav, onSwitchRole }) => (
            <div className="flex h-screen bg-slate-50 text-slate-800 font-sans">
                <aside className="w-64 bg-slate-900 text-white flex flex-col shadow-2xl z-20">
                    <div className="p-6 border-b border-slate-800">
                        <div className="flex items-center gap-3">
                            <div className="bg-emerald-500 p-2 rounded-lg"><i className="fas fa-shield-alt text-white"></i></div>
                            <div><h1 className="font-bold text-xl tracking-tight">Wathiq.om</h1><p className="text-[10px] text-slate-400 uppercase tracking-widest">Trust Engine</p></div>
                        </div>
                    </div>
                    <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                        <div className="px-2 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">{role} Tools</div>
                        {role === 'Tenant' ? (
                            <>
                                <button onClick={() => onNav('marketplace')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition text-slate-300 hover:text-white"><i className="fas fa-search w-5"></i> Browse Listings</button>
                                <button onClick={() => onNav('application-view')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition text-slate-300 hover:text-white"><i className="fas fa-inbox w-5"></i> My Applications</button>
                                <button onClick={() => onNav('active-contracts')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition text-slate-300 hover:text-white"><i className="fas fa-file-contract w-5"></i> Active Contracts</button>
                            </>
                        ) : (
                            <>
                                <button onClick={() => onNav('landlord_dash')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition text-slate-300 hover:text-white"><i className="fas fa-chart-line w-5"></i> Dashboard</button>
                                <button onClick={() => onNav('active-contracts')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-800 transition text-slate-300 hover:text-white"><i className="fas fa-file-signature w-5"></i> Active Leases</button>
                            </>
                        )}
                    </nav>
                    <div className="p-4 border-t border-slate-800">
                        <div className="flex items-center gap-3">
                            <img src={role === 'Tenant' ? TENANT.avatar : LANDLORDS['Ahmed'].avatar} className="w-10 h-10 rounded-full border-2 border-slate-700" />
                            <div><div className="text-sm font-medium">{role === 'Tenant' ? TENANT.name : LANDLORDS['Ahmed'].name}</div><div className="text-xs text-emerald-400">{role} Account</div></div>
                        </div>
                        <button onClick={onSwitchRole} className="mt-4 w-full bg-slate-800 text-xs py-2 rounded text-slate-400 hover:text-white border border-slate-700">Switch Role (Demo)</button>
                    </div>
                </aside>
                <main className="flex-1 flex flex-col h-screen overflow-hidden relative">
                    <header className="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-8 shadow-sm z-10">
                        <h2 className="font-semibold text-lg text-slate-800">Oman's Safe Renting Ecosystem</h2>
                        <div className="flex items-center gap-4">
                            <span className="bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full text-xs font-bold border border-emerald-100 flex items-center gap-2"><span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> System Live</span>
                        </div>
                    </header>
                    <div className="flex-1 overflow-y-auto p-8">{children}</div>
                </main>
            </div>
        );

        const Marketplace = ({ onSelect }) => (
            <div className="slide-in">
                <div className="mb-8 flex gap-4">
                    <div className="relative flex-1">
                        <i className="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" placeholder="Search Al Mouj, Muscat Hills, Azaiba..." className="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500" />
                    </div>
                    <button className="bg-white border border-slate-300 px-4 py-2 rounded-lg text-slate-600 font-medium"><i className="fas fa-filter mr-2"></i> Filters</button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {PROPERTIES.map(p => {
                        const l = LANDLORDS[p.landlord];
                        return (
                            <div key={p.id} onClick={() => onSelect(p)} className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-xl transition group cursor-pointer transform hover:-translate-y-1">
                                <div className="h-48 bg-slate-200 relative">
                                    <img src={p.img} className="w-full h-full object-cover" />
                                    <div className="absolute top-3 right-3 bg-white/90 backdrop-blur px-2 py-1 rounded-md text-xs font-bold shadow-sm flex items-center gap-1"><i className="fas fa-check-circle text-emerald-500"></i> Verified</div>
                                    <div className="absolute bottom-3 left-3 bg-slate-900/80 text-white px-2 py-1 rounded text-xs font-bold">{p.loc}</div>
                                </div>
                                <div className="p-5">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className="font-bold text-lg text-slate-800">{p.title}</h3>
                                            <div className="flex gap-3 text-xs text-slate-500 mt-1"><span><i className="fas fa-bed"></i> {p.beds}</span><span><i className="fas fa-bath"></i> {p.baths}</span><span><i className="fas fa-ruler-combined"></i> {p.area}m²</span></div>
                                        </div>
                                        <div className="text-right"><div className="text-xl font-bold text-emerald-600">{p.price} OMR</div><div className="text-xs text-slate-400">/ Monthly</div></div>
                                    </div>
                                    <div className="flex items-center gap-2 pt-3 border-t border-slate-100">
                                        <img src={l.avatar} className="w-6 h-6 rounded-full" />
                                        <span className="text-xs font-bold text-slate-600">{l.name}</span>
                                        <span className="flex items-center gap-1 text-xs text-yellow-500 font-bold ml-auto"><i className="fas fa-star"></i> {l.rating}</span>
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        );

        const PropertyModal = ({ property, onClose, onApply }) => {
            const l = LANDLORDS[property.landlord];
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden relative max-h-[90vh] overflow-y-auto slide-in">
                        <button onClick={onClose} className="absolute top-4 right-4 bg-black/50 hover:bg-black/70 p-2 rounded-full text-white z-10 transition"><i className="fas fa-times"></i></button>
                        <div className="h-64 relative">
                            <img src={property.img} className="w-full h-full object-cover" />
                            <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/90 to-transparent p-6 pt-20">
                                <h2 className="text-3xl font-bold text-white">{property.title}</h2>
                                <div className="text-white/80 text-sm flex gap-4 mt-1">
                                    <span><i className="fas fa-map-marker-alt"></i> {property.loc}</span>
                                    <span className="bg-emerald-500 text-white px-2 rounded text-xs font-bold flex items-center"><i className="fas fa-shield-alt mr-1"></i> Verified Property</span>
                                </div>
                            </div>
                        </div>
                        <div className="p-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div className="md:col-span-2 space-y-6">
                                <div className="flex gap-6 text-sm text-slate-600 border-b pb-4"><span><i className="fas fa-bed"></i> {property.beds} Beds</span><span><i className="fas fa-bath"></i> {property.baths} Baths</span><span><i className="fas fa-ruler"></i> {property.area} sqm</span></div>
                                <div><h3 className="font-bold text-lg mb-2">Description</h3><p className="text-sm text-slate-600 leading-relaxed">Experience luxury living in this premium unit. Featuring modern finishes, high-speed internet readiness, and proximity to key amenities.</p></div>
                                <div><h3 className="font-bold text-lg mb-2">Landlord Reviews</h3>
                                    <div className="space-y-2">
                                        {l.reviews.length > 0 ? l.reviews.map((r, i) => (
                                            <div key={i} className="bg-slate-50 p-3 rounded border border-slate-100 text-xs">
                                                <span className="font-bold text-slate-700">{r.user}</span> <span className="text-yellow-500">★★★★★</span>
                                                <p className="text-slate-500 mt-1">"{r.comment}"</p>
                                            </div>
                                        )) : <p className="text-xs text-slate-400">No reviews yet.</p>}
                                    </div>
                                </div>
                            </div>
                            <div className="bg-slate-50 p-5 rounded-xl border border-slate-100 h-fit text-center">
                                <img src={l.avatar} className="w-16 h-16 rounded-full mx-auto mb-3 border-4 border-white shadow" />
                                <div className="font-bold text-slate-800">{l.name}</div>
                                <div className="text-xs text-slate-500 mb-2">{l.verified ? 'Verified Owner' : 'Owner'}</div>
                                <div className="flex items-center justify-center gap-1 text-yellow-500 font-bold text-sm mb-4"><i className="fas fa-star"></i> {l.rating} <span className="text-slate-400 font-normal">({l.reviews.length} Reviews)</span></div>
                                <button onClick={onApply} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-slate-800 transition transform hover:-translate-y-1">Apply & Rent <i className="fas fa-arrow-right ml-2"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ContractView = ({ property, tenantSigned, landlordSigned, onSign, role, autoFillAnimation, paymentComplete, onSendToLandlord }) => {
            const l = LANDLORDS[property.landlord];
            const [fields, setFields] = useState({});
            
            // Auto-fill effect only if requested (when Tenant first applies)
            useEffect(() => {
                const data = {
                    owner_name: l.name, owner_id: l.id, owner_mob: l.mobile,
                    landlord_name: l.name, landlord_id: l.id, landlord_mob: l.mobile,
                    tenant_name: TENANT.name, tenant_id: TENANT.id, tenant_mob: TENANT.mobile, tenant_email: TENANT.email,
                    b_no: property.bldg, w_no: property.way, blk: property.block, plot: property.plot,
                    elec: property.elec, water: property.water, rent: property.price
                };
                
                if (autoFillAnimation) {
                    let delay = 500;
                    Object.keys(data).forEach(k => { setTimeout(() => setFields(prev => ({...prev, [k]: data[k]})), delay); delay += 80; });
                } else {
                    // Populate instantly for subsequent views
                    setFields(data);
                }
            }, []);

            return (
                <div className="mm-form slide-in relative">
                    <div className="flex justify-between items-center border-b-2 border-black pb-6 mb-8">
                        <div className="text-center w-1/3"><div className="font-bold text-xl">Rent Contract</div><div className="font-bold text-xl font-arabic">عقد إيجار</div></div>
                        <div className="text-center w-1/3"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/Emblem_of_Oman.svg/1200px-Emblem_of_Oman.svg.png" className="h-16 mx-auto opacity-80" /><div className="text-xs font-bold mt-2 tracking-widest">SULTANATE OF OMAN</div></div>
                        <div className="text-center w-1/3"><div className="border border-slate-400 p-2 rounded bg-slate-50 inline-block"><div className="text-[10px] text-slate-500 uppercase">Agreement No</div><div className="text-lg font-mono font-bold text-emerald-700">2026-WQ-8821</div></div></div>
                    </div>
                    {autoFillAnimation && Object.keys(fields).length < 10 && <div className="absolute top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg z-20 flex items-center gap-2 animate-pulse"><i className="fas fa-magic"></i> Auto-Filling from Mala'a...</div>}
                    <div className="mb-6 border border-slate-200 rounded overflow-hidden">
                        <div className="bg-slate-100 p-2 font-bold text-xs uppercase text-slate-700">1. Property Owner / Landlord</div>
                        <div className="grid grid-cols-4 gap-4 p-4">
                            <div className="col-span-2"><span className="mm-label">Name</span><div className={`mm-input ${fields.owner_name && autoFillAnimation && 'typing'}`}>{fields.owner_name}</div></div>
                            <div><span className="mm-label">ID No</span><div className={`mm-input ${fields.owner_id && autoFillAnimation && 'typing'}`}>{fields.owner_id}</div></div>
                            <div><span className="mm-label">Mobile</span><div className={`mm-input ${fields.owner_mob && autoFillAnimation && 'typing'}`}>{fields.owner_mob}</div></div>
                        </div>
                    </div>
                    <div className="mb-6 border border-blue-200 rounded overflow-hidden">
                        <div className="bg-blue-50 p-2 font-bold text-xs uppercase text-blue-800 flex justify-between"><span>2. Tenant Details</span><span><i className="fas fa-magic"></i> Auto-Filled via Mala'a</span></div>
                        <div className="grid grid-cols-4 gap-4 p-4">
                            <div className="col-span-2"><span className="mm-label">Name</span><div className={`mm-input ${fields.tenant_name && autoFillAnimation && 'typing'}`}>{fields.tenant_name}</div></div>
                            <div><span className="mm-label">ID No</span><div className={`mm-input ${fields.tenant_id && autoFillAnimation && 'typing'}`}>{fields.tenant_id}</div></div>
                            <div><span className="mm-label">Mobile</span><div className={`mm-input ${fields.tenant_mob && autoFillAnimation && 'typing'}`}>{fields.tenant_mob}</div></div>
                        </div>
                    </div>
                    <div className="mb-6 border border-slate-200 rounded overflow-hidden">
                        <div className="bg-slate-100 p-2 font-bold text-xs uppercase text-slate-700">3. Property Details & Accounts</div>
                        <div className="grid grid-cols-4 gap-4 p-4">
                            <div><span className="mm-label">Block</span><div className={`mm-input ${fields.blk && autoFillAnimation && 'typing'}`}>{fields.blk}</div></div>
                            <div><span className="mm-label">Way No</span><div className={`mm-input ${fields.w_no && autoFillAnimation && 'typing'}`}>{fields.w_no}</div></div>
                            <div><span className="mm-label">Building</span><div className={`mm-input ${fields.b_no && autoFillAnimation && 'typing'}`}>{fields.b_no}</div></div>
                            <div><span className="mm-label">Plot</span><div className={`mm-input ${fields.plot && autoFillAnimation && 'typing'}`}>{fields.plot}</div></div>
                            <div><span className="mm-label">Electricity Acc</span><div className={`mm-input ${fields.elec && autoFillAnimation && 'typing'}`}>{fields.elec}</div></div>
                            <div><span className="mm-label">Water Acc</span><div className={`mm-input ${fields.water && autoFillAnimation && 'typing'}`}>{fields.water}</div></div>
                            <div className="col-span-2"><span className="mm-label">Rent (OMR)</span><div className={`mm-input font-bold text-emerald-600 ${fields.rent && autoFillAnimation && 'typing'}`}>{fields.rent}</div></div>
                        </div>
                    </div>
                    <div className="mt-12 flex justify-between items-end px-10 relative">
                        <div className="text-center w-1/3"><div className="border-b-2 border-slate-300 h-12 mb-2 flex items-end justify-center">
                            {landlordSigned ? <span className="signature-font text-slate-800 text-2xl transform -rotate-2">{l.name}</span> : 
                            (role === 'Landlord' && <button onClick={onSign} className="bg-emerald-600 text-white px-4 py-1 rounded text-xs animate-bounce shadow-lg">Approve & Issue Contract</button>)}
                        </div><div className="text-[10px] uppercase font-bold text-slate-400">Lessor Signature</div></div>
                        <div className="text-center w-1/3"><div className="border-b-2 border-slate-300 h-12 mb-2 flex items-end justify-center">
                            {tenantSigned ? <span className="signature-font text-blue-600 text-2xl transform -rotate-3">{TENANT.name}</span> : 
                            (role === 'Tenant' && !landlordSigned && <button onClick={onSign} className="bg-blue-600 text-white px-4 py-1 rounded text-xs animate-pulse">Sign Digitally</button>)}
                            {role === 'Tenant' && landlordSigned && <span className="signature-font text-blue-600 text-2xl transform -rotate-3">{TENANT.name}</span>}
                        </div><div className="text-[10px] uppercase font-bold text-slate-400">Tenant Signature</div></div>
                    </div>
                    {role === 'Tenant' && !landlordSigned && tenantSigned && (
                        <div className="mt-8 text-center slide-in">
                            <button onClick={onSendToLandlord} className="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-full font-bold shadow-lg animate-bounce transition transform hover:scale-105 flex items-center justify-center mx-auto gap-2">
                                <i className="fas fa-paper-plane"></i> Send to Landlord
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const MoneyFlow = ({ rent, onConfirm }) => (
            <div className="max-w-3xl mx-auto mt-10 bg-white rounded-2xl shadow-xl p-10 slide-in text-center border border-slate-200">
                <h2 className="text-2xl font-bold mb-10 text-slate-800">Secure Direct Debit Authorization</h2>
                <div className="flex justify-between items-center mb-12 relative px-4">
                    <div className="relative z-10 w-24">
                        <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-2xl mx-auto mb-2 font-bold shadow-lg"><i className="fas fa-wallet"></i></div>
                        <div className="font-bold text-sm">Tenant</div><div className="text-xs text-slate-500 font-mono">-{rent * 1.05} OMR</div>
                    </div>
                    <div className="flex-1 mx-4 relative h-32">
                        <div className="absolute top-4 left-0 w-full flex items-center"><div className="flow-line w-full"><div className="flow-dot" style={{animationDuration:'1.5s'}}></div></div><div className="absolute -top-4 w-full text-[10px] text-slate-400 font-bold">RENT ({rent} OMR)</div></div>
                        <div className="absolute top-1/2 left-0 w-full flex items-center transform -translate-y-1/2"><div className="flow-line w-full"><div className="flow-dot" style={{animationDuration:'2s'}}></div></div><div className="absolute -top-4 w-full text-[10px] text-slate-400 font-bold">TAX ({rent * 0.05} OMR)</div></div>
                        <div className="absolute bottom-4 left-0 w-full flex items-center"><div className="flow-line w-full"><div className="flow-dot" style={{animationDuration:'2.5s'}}></div></div><div className="absolute -top-4 w-full text-[10px] text-slate-400 font-bold">FEE (0 OMR)</div></div>
                    </div>
                    <div className="flex flex-col gap-6 relative z-10 w-32">
                        <div className="flex items-center gap-3 text-left"><div className="w-8 h-8 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-xs shadow"><i className="fas fa-home"></i></div><div><div className="text-xs font-bold">Landlord</div><div className="text-[9px] text-slate-400">Thawani Split</div></div></div>
                        <div className="flex items-center gap-3 text-left"><div className="w-8 h-8 bg-slate-100 text-slate-600 rounded-full flex items-center justify-center text-xs shadow"><i className="fas fa-university"></i></div><div><div className="text-xs font-bold">Municipality</div><div className="text-[9px] text-slate-400">Auto-Tax</div></div></div>
                        <div className="flex items-center gap-3 text-left"><div className="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs shadow"><i className="fas fa-shield-alt"></i></div><div><div className="text-xs font-bold">Wathiq</div><div className="text-[9px] text-slate-400">Platform Fee</div></div></div>
                    </div>
                </div>
                <div className="bg-yellow-50 text-yellow-800 p-4 rounded-xl text-xs text-left mb-8 border border-yellow-100 flex gap-3"><i className="fas fa-lock mt-1"></i><div><strong>Compliance Notice (CBO Circular BM 1192):</strong><br/>Wathiq does not hold funds. All payments are routed directly via Thawani PSP to beneficiary accounts.</div></div>
                <button onClick={onConfirm} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-slate-800 transition">Confirm Standing Order</button>
            </div>
        );

        const LandlordDashboard = ({ landlordName, onSign, hasApp, contractSigned, onReview }) => {
            const [showProfile, setShowProfile] = useState(false);
            useEffect(() => {
                const ctx = document.getElementById('revChart').getContext('2d');
                new Chart(ctx, { type: 'bar', data: { labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'], datasets: [{ label: 'Actual Revenue', data: [1200, 1200, 1200, 0, 0], backgroundColor: '#10b981' }, { label: 'Projected', data: [0, 0, 0, 1800, 1800], backgroundColor: '#94a3b8' }] }, options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } } });
            }, []);

            return (
                <div className="grid grid-cols-3 gap-6 slide-in">
                    {/* TENANT PROFILE MODAL (PRIVACY UPDATED) */}
                    {showProfile && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-lg rounded-2xl shadow-xl p-6 relative slide-in">
                                <button onClick={() => setShowProfile(false)} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i className="fas fa-times text-xl"></i></button>
                                <div className="text-center mb-6">
                                    <img src={TENANT.avatar} className="w-20 h-20 rounded-full mx-auto border-4 border-emerald-100" />
                                    <h3 className="font-bold text-xl mt-2">{TENANT.name}</h3>
                                    <div className="text-emerald-600 text-sm font-bold">Mala'a Score: 720 (Excellent)</div>
                                </div>
                                <div className="space-y-4">
                                    <div className="bg-slate-50 p-4 rounded border border-slate-100 text-sm">
                                        <div className="flex justify-between mb-2"><span className="text-slate-500">Employment Sector</span><span className="font-bold">{TENANT.sector}</span></div>
                                        <div className="flex justify-between mb-2"><span className="text-slate-500">Nationality</span><span className="font-bold">{TENANT.nationality}</span></div>
                                        <div className="flex justify-between"><span className="text-slate-500">Verified ID</span><span className="font-bold">{TENANT.id}</span></div>
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-sm mb-2">Previous Landlord Reviews</h4>
                                        {TENANT.reviews.map((r, i) => (
                                            <div key={i} className="text-xs bg-yellow-50 p-3 rounded mb-2 text-slate-600 italic border border-yellow-100">
                                                <i className="fas fa-quote-left text-yellow-400 mr-2"></i> {r.comment} <span className="block text-right font-bold not-italic mt-1">- {r.user}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="mt-6 flex gap-3">
                                    <button onClick={() => setShowProfile(false)} className="flex-1 border border-slate-300 py-2 rounded font-bold text-slate-600">Close</button>
                                    <button onClick={() => { setShowProfile(false); onReview(); }} className="flex-1 bg-emerald-600 text-white py-2 rounded font-bold">Proceed to Sign Contract</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="col-span-2 space-y-6">
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm"><h3 className="font-bold text-lg mb-4">Revenue Overview</h3><canvas id="revChart" height="120"></canvas></div>
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 className="font-bold text-lg mb-4">Application Manager</h3>
                            <div className="space-y-4">
                                {hasApp && (
                                    <div className="flex gap-4 p-4 bg-blue-50 border border-blue-100 rounded-xl items-start relative overflow-hidden">
                                        <div className="absolute top-0 right-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded-bl">PENDING REVIEW</div>
                                        <img src={TENANT.avatar} className="w-12 h-12 rounded-full border-2 border-white shadow" />
                                        <div className="flex-1">
                                            <div className="flex justify-between"><div className="font-bold">{TENANT.name}</div><span className="text-xs text-slate-400">Just Now</span></div>
                                            <div className="flex gap-2 text-xs mt-1 mb-2"><span className="bg-emerald-100 text-emerald-700 px-2 rounded font-bold">Mala'a: 720</span><span className="bg-yellow-100 text-yellow-700 px-2 rounded font-bold"><i className="fas fa-star"></i> {TENANT.rating}</span></div>
                                            <div className="flex gap-2">
                                                {contractSigned ? 
                                                    <button className="bg-gray-200 text-gray-500 px-4 py-2 rounded text-xs font-bold cursor-default">Contract Active</button> : 
                                                    <button onClick={() => setShowProfile(true)} className="bg-emerald-600 text-white px-4 py-2 rounded text-xs font-bold hover:bg-emerald-700 shadow">Review Application</button>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div className="flex gap-4 p-4 bg-white border border-slate-100 rounded-xl items-start opacity-60">
                                    <img src="https://ui-avatars.com/api/?name=Ali+H&background=random" className="w-12 h-12 rounded-full" />
                                    <div className="flex-1">
                                        <div className="font-bold">Ali Al-Habsi</div>
                                        <div className="text-xs text-red-500 font-bold mt-1">Mala'a: 580 (Low)</div>
                                        <button className="mt-2 text-xs text-slate-400 border px-2 py-1 rounded">Rejected (Auto)</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="space-y-6">
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm"><h3 className="font-bold text-lg mb-4">Active Listings</h3><div className="space-y-3"><div className="flex gap-3 items-center p-3 bg-slate-50 rounded border border-slate-100"><img src={PROPERTIES[0].img} className="w-12 h-12 rounded object-cover" /><div><div className="font-bold text-sm">Al Mouj 2BHK</div><div className="text-xs text-emerald-600 font-bold">Published</div></div></div><div className="flex gap-3 items-center p-3 bg-slate-50 rounded border border-slate-100 opacity-60"><img src={PROPERTIES[4].img} className="w-12 h-12 rounded object-cover" /><div><div className="font-bold text-sm">Shatti Villa</div><div className="text-xs text-slate-500">Occupied</div></div></div></div></div>
                    </div>
                </div>
            );
        };

        const SuccessView = ({ onDone }) => (
            <div className="max-w-md mx-auto mt-20 text-center slide-in bg-white p-10 rounded-2xl shadow-xl border border-emerald-100">
                <div className="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i className="fas fa-check text-4xl text-emerald-600"></i>
                </div>
                <h2 className="text-3xl font-bold text-slate-800 mb-2">Payment Successful!</h2>
                <p className="text-slate-500 mb-8">Contract is now an Executive Instrument (Sanad Tanfidhi). Direct Debit is active.</p>
                <div className="bg-slate-50 p-4 rounded-xl text-left text-sm mb-8 border border-slate-200">
                    <div className="flex justify-between mb-2"><span className="text-slate-500">Transaction ID</span><span className="font-mono">TXN-882910</span></div>
                    <div className="flex justify-between mb-2"><span className="text-slate-500">First Payment</span><span className="font-bold">600 OMR</span></div>
                    <div className="flex justify-between"><span className="text-slate-500">Next Due Date</span><span className="font-bold">01/04/2026</span></div>
                </div>
                <button onClick={onDone} className="w-full bg-slate-900 text-white px-8 py-3 rounded-xl font-bold">Go to Active Contracts</button>
            </div>
        );

        const ActiveContracts = ({ role }) => (
            <div className="max-w-4xl mx-auto p-6 slide-in">
                <h3 className="font-bold text-xl mb-6">Active Contracts</h3>
                <div className="bg-white rounded-xl shadow border border-slate-200 overflow-hidden relative">
                    {/* STAMP FOR ACTIVE CONTRACT */}
                    <div className="absolute top-4 right-4 z-10 stamp-active transform rotate-12 opacity-80 pointer-events-none">
                        <div className="w-32 h-32 rounded-full border-4 border-emerald-800 text-emerald-800 flex flex-col items-center justify-center bg-emerald-50/50 backdrop-blur-sm">
                            <div className="text-[8px] font-black tracking-widest uppercase">Registered</div>
                            <div className="font-black text-xs my-1 border-y-2 border-emerald-800 text-center leading-tight">EXECUTIVE<br/>INSTRUMENT</div>
                            <div className="text-[8px] font-bold">RD 15/2025</div>
                        </div>
                    </div>

                    <div className="flex gap-6 p-6">
                        <img src={PROPERTIES[0].img} className="w-48 h-32 object-cover rounded-lg" />
                        <div className="flex-1">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h4 className="font-bold text-lg">Sea View 2BHK - Al Mouj</h4>
                                    <p className="text-sm text-slate-500 mb-2">Contract #2026-WQ-8821</p>
                                    <span className="bg-emerald-100 text-emerald-700 text-xs px-2 py-1 rounded font-bold flex items-center gap-1 w-fit"><i className="fas fa-shield-alt"></i> Executive Instrument Active</span>
                                </div>
                                <div className="text-right">
                                    <div className="font-bold text-xl text-emerald-600">600 OMR</div>
                                    <div className="text-xs text-slate-400">Monthly</div>
                                </div>
                            </div>
                            <div className="mt-6 flex gap-3">
                                <button className="bg-white border border-slate-300 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-50">Download Contract</button>
                                <button className="bg-white border border-slate-300 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-50">{role === 'Tenant' ? 'Report Issue' : 'Payment History'}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [view, setView] = useState('landing');
            const [role, setRole] = useState('Tenant');
            const [selectedProp, setSelectedProp] = useState(null);
            const [appSent, setAppSent] = useState(false);
            const [landlordSigned, setLandlordSigned] = useState(false);
            const [tenantSigned, setTenantSigned] = useState(false);
            const [paid, setPaid] = useState(false);

            return (
                <div>
                    {view === 'landing' ? (
                        <LandingPage onNav={(dest) => { if(dest==='landlord') { setRole('Landlord'); setView('landlord_dash'); } else { setRole('Tenant'); setView('marketplace'); } }} />
                    ) : (
                        <DashboardLayout role={role} onNav={setView} onSwitchRole={() => { setRole(role==='Tenant'?'Landlord':'Tenant'); setView(role==='Tenant'?'landlord_dash':'marketplace'); }}>
                            {view === 'marketplace' && <Marketplace onSelect={(p) => { setSelectedProp(p); setView('modal'); }} />}
                            {view === 'modal' && <PropertyModal property={selectedProp} onClose={() => setView('marketplace')} onApply={() => setView('upload')} />}
                            {view === 'upload' && <div className="max-w-md mx-auto mt-10 bg-white p-10 rounded-2xl shadow-xl text-center slide-in"><i className="fas fa-id-card text-6xl text-blue-500 mb-6"></i><h2 className="text-2xl font-bold mb-2">Identity Verification</h2><p className="text-slate-500 mb-8">Upload Mala'a Report to verify eligibility.</p><button onClick={() => { setView('contract-fill'); }} className="w-full py-4 border-2 border-dashed border-blue-300 text-blue-600 font-bold rounded-xl hover:bg-blue-50">Upload PDF</button></div>}
                            
                            {/* NEW: Contract Auto-Fill View for Tenant */}
                            {view === 'contract-fill' && <div className="max-w-4xl mx-auto"><ContractView property={selectedProp} tenantSigned={tenantSigned} landlordSigned={landlordSigned} role={role} autoFillAnimation={true} onSign={() => { setTenantSigned(true); }} onSendToLandlord={() => { setAppSent(true); alert("Application & Contract Sent to Landlord!"); setView('application-view'); }} /></div>}

                            {/* TENANT: MY APPS */}
                            {view === 'application-view' && <div className="max-w-4xl mx-auto p-6 slide-in"><h3 className="font-bold text-xl mb-4">My Applications</h3>{appSent ? <div className="bg-white p-6 rounded-xl border shadow-sm flex justify-between items-center"><div><h4 className="font-bold text-lg">{selectedProp.title}</h4><p className="text-sm text-slate-500">{landlordSigned ? "Approved & Countersigned" : "Pending Landlord Approval"}</p></div>{landlordSigned && !paid ? <button onClick={() => setView('payment')} className="bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold shadow animate-bounce">Setup Direct Debit</button> : <span className="bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-xs font-bold">{paid ? "Active" : "Waiting for Landlord"}</span>}</div> : <div className="text-center py-10 text-slate-400">No active applications.</div>}</div>}

                            {/* LANDLORD: REVIEW CONTRACT */}
                            {view === 'contract' && <div className="max-w-4xl mx-auto"><ContractView property={selectedProp} tenantSigned={tenantSigned} landlordSigned={landlordSigned} role={role} onSign={() => { if(role==='Landlord') { setLandlordSigned(true); alert("Contract Countersigned! Sent to Tenant for Payment."); } }} /></div>}
                            
                            {/* SHARED STAMP OVERLAY */}
                            {tenantSigned && landlordSigned && paid && view === 'active-contracts' && <div className="stamp-container stamp-active fixed top-1/2 left-1/2 transform -translate-x-1/2 z-50"><div className="w-48 h-48 rounded-full border-[6px] border-emerald-800 text-emerald-800 flex flex-col items-center justify-center bg-white/90 backdrop-blur shadow-2xl"><div className="text-xs font-black tracking-widest uppercase">Registered</div><div className="font-black text-sm my-2 border-y-2 border-emerald-800">EXECUTIVE<br/>INSTRUMENT</div><div className="text-[10px] font-bold">RD 15/2025</div></div></div>}

                            {view === 'payment' && <MoneyFlow rent={selectedProp.price} onConfirm={() => { setPaid(true); setView('success'); }} />}
                            {view === 'success' && <SuccessView onDone={() => setView('active-contracts')} />}
                            {view === 'active-contracts' && <ActiveContracts role={role} />}
                            {view === 'landlord_dash' && <LandlordDashboard hasApp={appSent} contractSigned={paid} onReview={() => setView('contract')} />}
                        </DashboardLayout>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

